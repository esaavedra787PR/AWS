Link: https://stackoverflow.com/questions/42617247/aws-s3-how-to-get-all-files-that-are-glacier-storage-class

To just query
aws s3api list-objects-v2 --bucket edwintest5 --query "Contents[?StorageClass=='DEEP_ARCHIVE']" --output text 

To query to a txt file. 
aws s3api list-objects-v2 --bucket edwintest5 --query "Contents[?StorageClass=='DEEP_ARCHIVE']" --output text > test.txt

With MAX item
aws s3api list-objects --bucket edwintest5 --query 'Contents[?StorageClass==`DEEP_ARCHIVE`]' --max-item 700000 > Deeparchives.txt

With MAX item
aws s3api list-objects --bucket edwintest5 --query 'Contents[?StorageClass==`GLACIER`]' --max-item 700000 > Glacier.txt


aws s3api list-objects-v2 --bucket edwintest5 --query "Contents[?StorageClass=='DEEP_ARCHIVE']" --output text > test.txt



check this code

# use awk to select filepath ("key") from output:
aws s3api list-objects-v2 \
  --bucket my-backup-bucket \
  --query "Contents[?StorageClass=='DEEP_ARCHIVE']" \
  --output text | awk '{print substr($0, index($0, $2))}' | awk '{NF-=3};3'  > backup_filelist.txt

# run init restore command on every file individually:
while read filename; do 

  aws s3api restore-object \
     --bucket my-backup-nas 
     --key $filename \
     --restore-request '{"Days":25,"GlacierJobParameters":{"Tier":"Standard"}}' ; 

done < backup_filelist.txt




